{"ast":null,"code":"var _jsxFileName = \"E:\\\\New folder\\\\New folder\\\\frontend\\\\src\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [token, setToken] = useState(localStorage.getItem('token'));\n  // include username for storage key\n  const [userProfile, setUserProfile] = useState({\n    id: '',\n    name: '',\n    avatar: '',\n    username: ''\n  });\n\n  // helper to stash locally by username\n  const saveLocalProfile = profile => {\n    if (profile.username) {\n      try {\n        localStorage.setItem('profile_' + profile.username, JSON.stringify(profile));\n      } catch {}\n    }\n  };\n\n  // when auth state changes: load cached then fetch server\n  useEffect(() => {\n    if (token) {\n      // load profile from storage based on username if known\n      if (userProfile.username) {\n        const saved = localStorage.getItem('profile_' + userProfile.username);\n        if (saved) {\n          try {\n            setUserProfile(JSON.parse(saved));\n          } catch {}\n        }\n      }\n      // then refresh from server\n      import('./api').then(({\n        getProfile\n      }) => {\n        getProfile(token).then(res => {\n          const prof = {\n            id: res.data.id || '',\n            name: res.data.name || '',\n            avatar: res.data.avatar || '',\n            username: res.data.username || ''\n          };\n          setUserProfile(prof);\n          saveLocalProfile(prof);\n        }).catch(() => {\n          // ignore failures\n        });\n      });\n    } else {\n      setUserProfile({\n        name: '',\n        avatar: '',\n        username: ''\n      });\n    }\n  }, [token]);\n  const login = (newToken, profile) => {\n    setToken(newToken);\n    localStorage.setItem('token', newToken);\n    if (profile) {\n      // ensure we copy id/username etc.\n      const prof = {\n        ...profile\n      };\n      setUserProfile(prof);\n      saveLocalProfile(prof);\n    }\n    // always fetch again to be safe\n    import('./api').then(({\n      getProfile\n    }) => {\n      getProfile(newToken).then(res => {\n        const prof = {\n          id: res.data.id || '',\n          name: res.data.name || '',\n          avatar: res.data.avatar || '',\n          username: res.data.username || ''\n        };\n        setUserProfile(prof);\n        saveLocalProfile(prof);\n      }).catch(() => {});\n    });\n  };\n  const logout = () => {\n    setToken(null);\n    localStorage.removeItem('token');\n    setUserProfile({\n      name: '',\n      avatar: '',\n      username: ''\n    });\n  };\n  const updateProfile = profile => {\n    // keep username the same\n    const updated = {\n      ...userProfile,\n      ...profile\n    };\n    setUserProfile(updated);\n    saveLocalProfile(updated);\n    if (token) {\n      import('./api').then(({\n        updateProfile\n      }) => {\n        updateProfile(token, profile).catch(() => {});\n      });\n    }\n  };\n\n  // migrate global history entry once when first user signs in\n  useEffect(() => {\n    const u = userProfile.username;\n    const id = userProfile.id;\n    if (!u && !id) return;\n    try {\n      // first, move any generic pre-login entries into the correct key\n      const generic = localStorage.getItem('habitHistory');\n      if (generic) {\n        const migrated = localStorage.getItem('historyMigrated');\n        const destKey = id ? 'habitHistory_id_' + id : 'habitHistory_' + u;\n        if (!migrated) {\n          localStorage.setItem(destKey, generic);\n          localStorage.removeItem('habitHistory');\n          localStorage.setItem('historyMigrated', u || id);\n        } else if (migrated !== (u || id)) {\n          localStorage.removeItem('habitHistory');\n        }\n      }\n\n      // next, if we now have a numeric id, migrate any old username-keyed data\n      if (id && u) {\n        const nameKey = 'habitHistory_' + u;\n        const idKey = 'habitHistory_id_' + id;\n        const nameData = localStorage.getItem(nameKey);\n        if (nameData) {\n          // if nothing at id key, just move it; if both exist, leave id key unchanged\n          if (!localStorage.getItem(idKey)) {\n            localStorage.setItem(idKey, nameData);\n          }\n          localStorage.removeItem(nameKey);\n        }\n      }\n    } catch (e) {\n      console.warn('history migration skipped', e);\n    }\n  }, [userProfile.username, userProfile.id]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      token,\n      login,\n      logout,\n      userProfile,\n      updateProfile\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 128,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"Bk9/Hf6xxORtoFcdL2Ms/Yuu27c=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","token","setToken","localStorage","getItem","userProfile","setUserProfile","id","name","avatar","username","saveLocalProfile","profile","setItem","JSON","stringify","saved","parse","then","getProfile","res","prof","data","catch","login","newToken","logout","removeItem","updateProfile","updated","u","generic","migrated","destKey","nameKey","idKey","nameData","e","console","warn","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/New folder/New folder/frontend/src/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [token, setToken] = useState(localStorage.getItem('token'));\r\n  // include username for storage key\r\n  const [userProfile, setUserProfile] = useState({ id: '', name: '', avatar: '', username: '' });\r\n\r\n  // helper to stash locally by username\r\n  const saveLocalProfile = (profile) => {\r\n    if (profile.username) {\r\n      try { localStorage.setItem('profile_' + profile.username, JSON.stringify(profile)); } catch {}\r\n    }\r\n  };\r\n\r\n  // when auth state changes: load cached then fetch server\r\n  useEffect(() => {\r\n    if (token) {\r\n      // load profile from storage based on username if known\r\n      if (userProfile.username) {\r\n        const saved = localStorage.getItem('profile_' + userProfile.username);\r\n        if (saved) {\r\n          try { setUserProfile(JSON.parse(saved)); } catch {}\r\n        }\r\n      }\r\n      // then refresh from server\r\n      import('./api').then(({ getProfile }) => {\r\n        getProfile(token).then(res => {\r\n          const prof = {\r\n            id: res.data.id || '',\r\n            name: res.data.name || '',\r\n            avatar: res.data.avatar || '',\r\n            username: res.data.username || ''\r\n          };\r\n          setUserProfile(prof);\r\n          saveLocalProfile(prof);\r\n        }).catch(() => {\r\n          // ignore failures\r\n        });\r\n      });\r\n    } else {\r\n      setUserProfile({ name: '', avatar: '', username: '' });\r\n    }\r\n  }, [token]);\r\n\r\n  const login = (newToken, profile) => {\r\n    setToken(newToken);\r\n    localStorage.setItem('token', newToken);\r\n    if (profile) {\r\n      // ensure we copy id/username etc.\r\n      const prof = { ...profile };\r\n      setUserProfile(prof);\r\n      saveLocalProfile(prof);\r\n    }\r\n    // always fetch again to be safe\r\n    import('./api').then(({ getProfile }) => {\r\n      getProfile(newToken).then(res => {\r\n        const prof = {\r\n          id: res.data.id || '',\r\n          name: res.data.name || '',\r\n          avatar: res.data.avatar || '',\r\n          username: res.data.username || ''\r\n        };\r\n        setUserProfile(prof);\r\n        saveLocalProfile(prof);\r\n      }).catch(() => {});\r\n    });\r\n  };\r\n\r\n  const logout = () => {\r\n    setToken(null);\r\n    localStorage.removeItem('token');\r\n    setUserProfile({ name: '', avatar: '', username: '' });\r\n  };\r\n\r\n  const updateProfile = (profile) => {\r\n    // keep username the same\r\n    const updated = { ...userProfile, ...profile };\r\n    setUserProfile(updated);\r\n    saveLocalProfile(updated);\r\n    if (token) {\r\n      import('./api').then(({ updateProfile }) => {\r\n        updateProfile(token, profile).catch(() => {});\r\n      });\r\n    }\r\n  };\r\n\r\n  // migrate global history entry once when first user signs in\r\n  useEffect(() => {\r\n    const u = userProfile.username;\r\n    const id = userProfile.id;\r\n    if (!u && !id) return;\r\n    try {\r\n      // first, move any generic pre-login entries into the correct key\r\n      const generic = localStorage.getItem('habitHistory');\r\n      if (generic) {\r\n        const migrated = localStorage.getItem('historyMigrated');\r\n        const destKey = id ? 'habitHistory_id_' + id : 'habitHistory_' + u;\r\n        if (!migrated) {\r\n          localStorage.setItem(destKey, generic);\r\n          localStorage.removeItem('habitHistory');\r\n          localStorage.setItem('historyMigrated', u || id);\r\n        } else if (migrated !== (u || id)) {\r\n          localStorage.removeItem('habitHistory');\r\n        }\r\n      }\r\n\r\n      // next, if we now have a numeric id, migrate any old username-keyed data\r\n      if (id && u) {\r\n        const nameKey = 'habitHistory_' + u;\r\n        const idKey = 'habitHistory_id_' + id;\r\n        const nameData = localStorage.getItem(nameKey);\r\n        if (nameData) {\r\n          // if nothing at id key, just move it; if both exist, leave id key unchanged\r\n          if (!localStorage.getItem(idKey)) {\r\n            localStorage.setItem(idKey, nameData);\r\n          }\r\n          localStorage.removeItem(nameKey);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.warn('history migration skipped', e);\r\n    }\r\n  }, [userProfile.username, userProfile.id]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ token, login, logout, userProfile, updateProfile }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}