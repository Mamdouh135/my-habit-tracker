{"ast":null,"code":"import _objectSpread from\"E:/New folder/New folder/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useState,useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export function AuthProvider(_ref){let{children}=_ref;const[token,setToken]=useState(localStorage.getItem('token'));// include username for storage key\nconst[userProfile,setUserProfile]=useState({id:'',name:'',avatar:'',username:''});// helper to stash locally by username\nconst saveLocalProfile=profile=>{if(profile.username){try{localStorage.setItem('profile_'+profile.username,JSON.stringify(profile));}catch(_unused){}}};// when auth state changes: load cached then fetch server\nuseEffect(()=>{if(token){// load profile from storage based on username if known\nif(userProfile.username){const saved=localStorage.getItem('profile_'+userProfile.username);if(saved){try{setUserProfile(JSON.parse(saved));}catch(_unused2){}}}// then refresh from server\nimport('./api').then(_ref2=>{let{getProfile}=_ref2;getProfile(token).then(res=>{const prof={id:res.data.id||'',name:res.data.name||'',avatar:res.data.avatar||'',username:res.data.username||''};setUserProfile(prof);saveLocalProfile(prof);}).catch(()=>{// ignore failures\n});});}else{setUserProfile({name:'',avatar:'',username:''});}},[token]);const login=(newToken,profile)=>{setToken(newToken);localStorage.setItem('token',newToken);if(profile){// ensure we copy id/username etc.\nconst prof=_objectSpread({},profile);setUserProfile(prof);saveLocalProfile(prof);}// always fetch again to be safe\nimport('./api').then(_ref3=>{let{getProfile}=_ref3;getProfile(newToken).then(res=>{const prof={id:res.data.id||'',name:res.data.name||'',avatar:res.data.avatar||'',username:res.data.username||''};setUserProfile(prof);saveLocalProfile(prof);}).catch(()=>{});});};const logout=()=>{setToken(null);localStorage.removeItem('token');setUserProfile({name:'',avatar:'',username:''});};const updateProfile=profile=>{// keep username the same\nconst updated=_objectSpread(_objectSpread({},userProfile),profile);setUserProfile(updated);saveLocalProfile(updated);if(token){import('./api').then(_ref4=>{let{updateProfile}=_ref4;updateProfile(token,profile).catch(()=>{});});}};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{token,login,logout,userProfile,updateProfile},children:children});}","map":{"version":3,"names":["React","createContext","useState","useEffect","jsx","_jsx","AuthContext","AuthProvider","_ref","children","token","setToken","localStorage","getItem","userProfile","setUserProfile","id","name","avatar","username","saveLocalProfile","profile","setItem","JSON","stringify","_unused","saved","parse","_unused2","then","_ref2","getProfile","res","prof","data","catch","login","newToken","_objectSpread","_ref3","logout","removeItem","updateProfile","updated","_ref4","Provider","value"],"sources":["E:/New folder/New folder/frontend/src/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [token, setToken] = useState(localStorage.getItem('token'));\r\n  // include username for storage key\r\n  const [userProfile, setUserProfile] = useState({ id: '', name: '', avatar: '', username: '' });\r\n\r\n  // helper to stash locally by username\r\n  const saveLocalProfile = (profile) => {\r\n    if (profile.username) {\r\n      try { localStorage.setItem('profile_' + profile.username, JSON.stringify(profile)); } catch {}\r\n    }\r\n  };\r\n\r\n  // when auth state changes: load cached then fetch server\r\n  useEffect(() => {\r\n    if (token) {\r\n      // load profile from storage based on username if known\r\n      if (userProfile.username) {\r\n        const saved = localStorage.getItem('profile_' + userProfile.username);\r\n        if (saved) {\r\n          try { setUserProfile(JSON.parse(saved)); } catch {}\r\n        }\r\n      }\r\n      // then refresh from server\r\n      import('./api').then(({ getProfile }) => {\r\n        getProfile(token).then(res => {\r\n          const prof = {\r\n            id: res.data.id || '',\r\n            name: res.data.name || '',\r\n            avatar: res.data.avatar || '',\r\n            username: res.data.username || ''\r\n          };\r\n          setUserProfile(prof);\r\n          saveLocalProfile(prof);\r\n        }).catch(() => {\r\n          // ignore failures\r\n        });\r\n      });\r\n    } else {\r\n      setUserProfile({ name: '', avatar: '', username: '' });\r\n    }\r\n  }, [token]);\r\n\r\n  const login = (newToken, profile) => {\r\n    setToken(newToken);\r\n    localStorage.setItem('token', newToken);\r\n    if (profile) {\r\n      // ensure we copy id/username etc.\r\n      const prof = { ...profile };\r\n      setUserProfile(prof);\r\n      saveLocalProfile(prof);\r\n    }\r\n    // always fetch again to be safe\r\n    import('./api').then(({ getProfile }) => {\r\n      getProfile(newToken).then(res => {\r\n        const prof = {\r\n          id: res.data.id || '',\r\n          name: res.data.name || '',\r\n          avatar: res.data.avatar || '',\r\n          username: res.data.username || ''\r\n        };\r\n        setUserProfile(prof);\r\n        saveLocalProfile(prof);\r\n      }).catch(() => {});\r\n    });\r\n  };\r\n\r\n  const logout = () => {\r\n    setToken(null);\r\n    localStorage.removeItem('token');\r\n    setUserProfile({ name: '', avatar: '', username: '' });\r\n  };\r\n\r\n  const updateProfile = (profile) => {\r\n    // keep username the same\r\n    const updated = { ...userProfile, ...profile };\r\n    setUserProfile(updated);\r\n    saveLocalProfile(updated);\r\n    if (token) {\r\n      import('./api').then(({ updateProfile }) => {\r\n        updateProfile(token, profile).catch(() => {});\r\n      });\r\n    }\r\n  };\r\n\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ token, login, logout, userProfile, updateProfile }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}